"use strict";function install(t){install.installed||(install.installed=!0,_Vue=t)}function vueMixinFetchDetail(t){if("string"==typeof t.key){var e=t.key.split("."),n=slicedToArray(e,2),i=n[0],r=n[1];t.detailName=i,t.keyName=r,utils.isObject(t.mixins)?t.mixins=[t.mixins]:utils.isArray(t.mixins)||(t.mixins=[]);var a=t.model();return{name:"fetchDetail",store:a,install:function(e){function n(e){for(var n=i.list,r=i.list.length,a=0;a<r;a++)if(String(n[a][t.keyName])===String(e))return a;return-1}var i=e.store.fetchList;return this.listUnwatch=e.vm.$watch("store.fetchList.list",function(e){var i=n(a[t.detailName][t.keyName]);if(i<0)return!1;var r=e[i];Object.keys(a[t.detailName]).forEach(function(e){Object.prototype.hasOwnProperty.call(r,e)&&(a[t.detailName][e]=r[e])})},{deep:!0}),this.detailUnwatch=e.vm.$watch("store.fetchDetail."+t.detailName,function(e){var r=n(a[t.detailName][t.keyName]);if(r<0)return!1;Object.keys(i.list[r]).forEach(function(t){i.list[r][t]=e[t]})},{deep:!0}),{mixins:t.mixins,props:[t.keyName],beforeRouteEnter:function(e,r,s){if(String(e.params[t.keyName])!==String(a[t.detailName][t.keyName])){var o=n(e.params[t.keyName]);Object.assign(a[t.detailName],t.model()[t.detailName],i.list[o]||{})}s()},computed:_extends({},utils.createComputed(a),{$fetchDetail:function(){function e(){if(n[t.keyName])return t.fetch.call(n).then(function(t){Object.assign(a,t)})}var n=this;return e}}),created:function(){this.$fetchDetail()},watch:defineProperty({},t.keyName,function(){this.$fetchDetail()})}},destroy:function(){this.listUnwatch(),this.detailUnwatch()}}}}function vueMixinFetchList(t){function e(t){var e=[];return Object.keys(t).forEach(function(n){return e.push(n+"="+t[n])}),e.join("&")}function n(){var e=t.model();Object.assign(i,e)}utils.isObject(t.mixins)?t.mixins=[t.mixins]:utils.isArray(t.mixins)||(t.mixins=[]);var i=t.model();return{name:"fetchList",store:i,install:function(r){var a="";return{beforeRouteEnter:function(t,i,r){e(t.query)!==a&&n(),r()},computed:_extends({},utils.createComputed(i),{$fetchList:function(){function r(){var n=e(s.$route.query);return t.fetch.call(s).then(function(t){if(n!==e(s.$route.query))return!1;Object.assign(i,t),a=n})}var s=this;return r.init=function(){n.apply(s,arguments)},r.search=function(){for(var e={},n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];event===i[0]&&(i[0]={}),utils.isObject(i[0])?e=i[0]:"string"==typeof i[0]&&(e[i[0]]=i[1]),e=Object.assign({},s.$route.query,defineProperty({},t.pagekey,1),s[t.queryKey],e),s.$router.push(_extends({},this.$route,{query:e}))},r.syncQuery=function(){var e=s[t.queryKey];utils.isObject(e)&&Object.keys(e).forEach(function(t){Object.prototype.hasOwnProperty.call(s.$route.query,t)&&(e[t]=s.$route.query[t])})},r}}),created:function(){this.$fetchList.syncQuery(),this.$fetchList()},watch:{"$route.query":function(t,n){if(this.$fetchList.syncQuery(),e(t)===e(n))return!1;this.$fetchList()}}}},destroy:function(t){}}}function vueMixinStore(t){var e={},n={},i={base:[],update:!0,fetch:function(){return Promise.resolve({})}};return Object.keys(t).forEach(function(e){var r=t[e];utils.isObject(r)?n[e]=Object.assign({},i,r):"function"==typeof r&&(n[e]=Object.assign({},i,{fetch:r}))}),{name:"store",store:e,install:function(t){return{created:function(){function t(t){t.forEach(function(t){a[t]=n[t]})}function i(t){var i=this,r=[],a=Object.keys(t),s=function(t,n){Object.defineProperty(n,"_ok_",{value:!0,enumerable:!1,configurable:!1,writable:!0}),i.$data[t]=e[t]=n};return a.forEach(function(e){var n=t[e],a=n.fetch.call(i).then(function(t){return s(e,t),t});r.push(a)}),Promise.all(r).then(function(t){Object.keys(n).forEach(function(e){var r=[],o=n[e];if(!o.base.length)return!1;for(var u=0;u<o.base.length;u++){var c=a.indexOf(o.base[u]);if(!(c>-1))break;r.push(t[c])}r.length===o.base.length&&s(e,o.fetch.apply(i,r))})})}var r=this,a={};Object.keys(n).forEach(function(i){if(!utils.isHas(r.$data,i))return!1;utils.isHas(e,i)?r.$data[i]=e[i]:_Vue.set(e,i,r.$data[i]);var s=n[i],o=e[i];if(!s.update&&o._ok_)return!1;0===s.base.length?a[i]=s:t(s.base)}),i.call(this,a)},computed:{$vueMixinStore:function(){return e}}}}}}Object.defineProperty(exports,"__esModule",{value:!0});var _Vue=void 0,utils={isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isHas:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},createComputed:function(t){var e={};return Object.keys(t).forEach(function(n){e[n]={get:function(){return t[n]},set:function(e){t[n]=e}}}),e}},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),defineProperty=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),VueMixin$1=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,t),this.mixins={},this.store={},this.plugins=n.plugins||[],this.vm=new _Vue({data:{store:this.store}}),this.plugins.forEach(function(t){e.mixins[t.name]=Object.assign(t.install(e))||{},utils.isObject(t.store)&&e.createStore(t.name,t.store)})}return createClass(t,[{key:"createStore",value:function(t,e){_Vue.set(this.store,t,e)}},{key:"destroy",value:function(){this.plugins.forEach(function(t){"function"==typeof t.destroy&&t.destroy()}),this.vm.destroy()}}]),t}();VueMixin$1.install=install,exports.default=VueMixin$1,exports.vueMixinFetchDetail=vueMixinFetchDetail,exports.vueMixinFetchList=vueMixinFetchList,exports.vueMixinStore=vueMixinStore;
//# sourceMappingURL=vue-mixin.min.js.map
